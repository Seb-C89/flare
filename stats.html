<!doctype html>
<html lang=en>
<head>
	<meta charset=utf-8>
	<title>blah</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
	<div id="unkik"></div>
	<p>I'm the content</p>
	<input type="file" id="input" name="input" />
	<canvas id="img"></canvas>
	<script>
		var fuck = {
			Jan : 1,
			Feb : 2,
			Mar : 3,
			Apr : 4,
			May : 5,
			Jun : 6,
			Jul : 7,
			Aug : 8,
			Sep : 9,
			Oct : 10,
			Nov : 11,
			Dec : 12
		}
		var res;
		var unik = {
			ip: {},
			http: {}
		};
		document.getElementById('input').onchange = function() {
			var file = this.files[0];

			var reader = new FileReader();
				reader.onload = function(progressEvent) {

					const i = this.result.matchAll(/^(?<ip>[0-9.]+) - - \[(?<date>.*)\] "(?<http>[^"]*)" (?<status>\d+) (?<size>\d+) "(?<referer>[^"]*)" "(?<agent>[^"]*)"$/gm)
					
					unik["ip"] = {}
					unik["date"] = {}
					unik["http"] = {}
					unik["status"] = {}
					unik["size"] = {}
					unik["referer"] = {}
					unik["agent"] = {}
					unik["date_d"] = {}
					unik["route"] = {}
					unik["method"] = {}

					res = Array.from(i, (match) => {
						const date = match.groups.date.match(/(?<day>\d{2})\/(?<mounth>\w{3})\/(?<year>\d{4}):(?<hour>\d{2}):(?<minute>\d{2}):(?<second>\d{2})/)
						match.groups.date = new Date(date.groups.year, fuck[date.groups.mounth]-1, date.groups.day, date.groups.hour, date.groups.minute, date.groups.second)
						match.groups.date_d = new Date(date.groups.year, fuck[date.groups.mounth]-1, date.groups.day, 0, 0, 0)
				
						const route = match.groups.http.match(/(?<method>.+) (?<route>\/.*) .*/)
						match.groups.route = route?.groups?.route || match.groups.http
						match.groups.method = route?.groups?.method || ""
						delete match.groups.http;

						let exclude = ["date", "size"];

						for(prop in match.groups) {
							if(exclude.includes(prop))
								continue;
							else {
								if(Object.hasOwn(unik[prop], match.groups[prop])){
									++unik[prop][match.groups[prop]]
									//console.log(prop, unik[prop])
								}
									
								else
									Object.defineProperty(unik[prop], match.groups[prop], {value: 1, writable: true});

								//match.groups[prop] = unik[prop][match.groups[prop]] // add reference instead of keep nth similar value
							}
						}

						/*// Unique IP
						if(Object.hasOwn(unik.ip, match.groups.ip))
							++unik.ip[match.groups.ip]
						else
							Object.defineProperty(unik.ip, match.groups.ip, {value: 1});

						match.groups.ip = unik.ip[match.groups.ip] // add reference instead of keep nth similar value
						
						// Unique HTTP request
						if(Object.hasOwn(unik.http, match.groups.http))
							++unik.http[match.groups.http]
						else
							Object.defineProperty(unik.http, match.groups.http, {value: 1});

						match.groups.http = unik.http[match.groups.http] // add reference instead of keep nth similar value
						*/
						
						return {...match.groups}
					})
				};
				reader.readAsText(file);
		};

		

	</script>
</body>
</html>